<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title></title>
  <link href="./package/leaflet/leaflet.min.css" rel="stylesheet">
  <script src="./package/leaflet/leaflet.min.js"></script>
  <style>
    body, html {
      margin: 0;
      padding: 0;
    }
    #container {
      width: 380px;
      height: 260px;
      position: relative;
    }
    .map {
      width: 100%;
      height: 100%;
      background-color: #5d5d5d;
    }
    .user-info-box {
      width: 100%;
      height: 58px;
      position: absolute;
      bottom: 0;
      z-index: 999;
      background-color: rgba(100, 100, 100, 0.4);
      backdrop-filter: blur(6px);
      display: flex;
      flex-direction: row;
      align-items: center;
      padding: 0 12px;
      box-sizing: border-box;
    }
    .avatar {
      width: 40px;
      height: 40px;
      border-radius: 4px;
    }
    .user {
      height: 40px;
      width: 180px;
    }
    .user {
      font-size: 14px;
      color: #eeeeee;
      margin-left: 10px;
      box-sizing: border-box;
    }
    .user .server-name-box {
      display: flex;
      align-items: center;
    }
    .user .username {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .user .server-name-box span {
      display: inline-block;
      max-width: 136px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      padding-right: 4px;
      box-sizing: border-box;
    }
    .location-box {
      flex-grow: 1;
      color: #eeeeee;
      font-size: 14px;
      height: 40px;
      box-sizing: border-box;
      border-right: 4px solid #54d354;
      text-align: right;
      padding-right: 6px;
    }
    .location-box>* {
      width: 116px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
  </style>
</head>
<body>
  <div id="container">
    <div id="map" class="map"></div>
    <div class="user-info-box">
      <img class="avatar" src="https://static.truckersmp.com/avatarsN/small/defaultavatar.png"/>
      <div class="user">
        <div class="username">...</div>
        <div class="server-name-box">
          <span class="server-name">...</span>游戏中
        </div>
      </div>
      <div class="location-box">
        <div class="country">...</div>
        <div class="real-name">...</div>
      </div>
    </div>
  </div>
  <script>
    // a: https://static.truckersmp.com/avatarsN/defaultavatar.png
    // sa: https://static.truckersmp.com/avatarsN/small/defaultavatar.png
    // name: Damien12345
    // x: -13426
    // y: -5998
    // serverName: Simulation 1
    // country: Germany
    // realName: Duisburg
    let multipliers = {
      x: 71292,
      y: 60412
    }
    let breakpoints = {
      uk: {
        x: -31056.8,
        y: -5832.867
      }
    }

    // 游戏地转地图坐标
    function calculateMapCoordinate(x, y) {
      return [
        x / 1.325928 + multipliers.x,
        y / 1.325928 + multipliers.y
      ];
    }

    // 定义地图
    let map = L.map('map', {
      attributionControl: false, // 去除右下角的 leaflet 标识
      crs: L.CRS.Simple,
      zoomControl: false
    });

    // 边界
    let bounds = L.latLngBounds(
      map.unproject([0, 131072], 2),
      map.unproject([131072, 0], 2)
    );

    // 瓦片地图
    L.tileLayer("https://ets-map.oss-cn-beijing.aliyuncs.com/ets2/05102019/{z}/{x}/{y}.png", {
      minZoom: 2,
      maxZoom: 10,
      maxNativeZoom: 8,
      tileSize: 512,
      bounds: bounds,
      reuseTiles: true
    }).addTo(map);
    map.setMaxBounds(
      new L.LatLngBounds(
        map.unproject([0, 131072], 8),
        map.unproject([131072, 0], 8)
      )
    );

    function setData(data) {
      document.getElementsByClassName('avatar')[0].src = data.avatar
      document.getElementsByClassName('username')[0].innerText = data.username
      document.getElementsByClassName('server-name')[0].innerText = data.serverName
      document.getElementsByClassName('country')[0].innerText = data.country
      document.getElementsByClassName('real-name')[0].innerText = data.realName

      let mapCoordinate = map.unproject(calculateMapCoordinate(data.x, data.y), 8)
      L.circleMarker(mapCoordinate, {
        color: '#3e9edc',       // 标记点边框颜色
        fillColor: '#3e9edc',   // 标记点填充颜色
        fillOpacity: 1,     // 标记点填充不透明度（0到1之间的值）
        radius: 6           // 标记点半径（以像素为单位）
      }).addTo(map);

      // 移动地图到坐标
      map.setView(mapCoordinate, 7);
    }
  </script>
</body>
</html>
